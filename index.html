<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cafeteria POS</title>
<meta name="theme-color" content="#222">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#222;color:#fff;padding:12px;text-align:center;font-size:18px}
.container{padding:10px}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
.product{background:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);position:relative}
.menu{position:absolute;top:5px;right:5px;font-size:18px;cursor:pointer}
.small{font-size:12px;color:#555}
.cart,.panel{background:#fff;margin-top:15px;padding:10px;border-radius:8px}
button{width:100%;padding:10px;margin-top:6px;border:none;border-radius:6px;font-size:15px;color:#fff}
.green{background:#28a745}
.red{background:#dc3545}
.blue{background:#007bff}
.gray{background:#6c757d}
.filter{display:flex;gap:6px;margin-top:8px}
.filter button{flex:1}
.hidden{display:none}
#scanner{width:100%;margin-top:10px}
</style>
</head>
<body>

<header>üìä Cafeteria POS</header>

<div class="container">

<!-- SESSION -->
<div class="panel">
<select id="worker">
<option>Admin 1</option><option>Admin 2</option><option>Admin 3</option>
<option>Admin 4</option><option>Admin 5</option><option>Admin 6</option><option>Admin 7</option>
</select>
<select id="shift"></select>
<button class="gray" onclick="endShift()">‚è± End Shift</button>
</div>

<!-- PRODUCTS -->
<h3>Products</h3>
<div class="filter">
<button class="gray" onclick="filterCat('all')">All</button>
<button class="blue" onclick="filterCat('Drink')">Drinks</button>
<button class="green" onclick="filterCat('Food')">Food</button>
</div>

<button class="blue" onclick="addProduct()">‚ûï Add Product</button>
<button class="gray" onclick="startScanSell()">üì∑ Scan (Sell)</button>

<div id="scanner" class="hidden"></div>
<div class="products" id="products"></div>

<!-- CART -->
<div class="cart">
<h3>Current Order</h3>
<div id="cartItems"></div>
<b>Total: <span id="total">0</span> DA</b>
<button class="green" onclick="checkout()">‚úî Validate Order</button>
<button class="red" onclick="clearCart()">‚úñ Clear</button>
</div>

</div>

<script>
/* ================== DATA ================== */
let PRODUCTS = JSON.parse(localStorage.getItem("products")) || [];
let cart = [];
let filter = "all";
let SHIFT = localStorage.getItem("shift") || "Morning";
shift.innerHTML = `<option>${SHIFT}</option>`;

/* ================== SAVE ================== */
function save(){
localStorage.setItem("products",JSON.stringify(PRODUCTS));
localStorage.setItem("shift",SHIFT);
}

/* ================== SHIFT ================== */
function endShift(){
SHIFT = SHIFT==="Morning" ? "Evening" : "Morning";
shift.innerHTML = `<option>${SHIFT}</option>`;
save(); alert("Shift changed to "+SHIFT);
}

/* ================== RENDER ================== */
function render(){
products.innerHTML="";
PRODUCTS.forEach((p,i)=>{
if(filter!=="all" && p.cat!==filter) return;
let d=document.createElement("div");
d.className="product";
d.innerHTML=`
<div class="menu" onclick="productMenu(${i})">‚ãÆ</div>
<b>${p.name}</b><br>
<span class="small">${p.price} DA ‚Äì ${p.cat}</span><br>
<span class="small">Stock: ${p.stock}</span>`;
d.onclick=()=>addToCart(i);
products.appendChild(d);
});
}
render();

/* ================== FILTER ================== */
function filterCat(c){filter=c;render();}

/* ================== ADD PRODUCT (INVENTORY) ================== */
function addProduct(){
let name = prompt("Product name");
if(!name) return;
let price = parseInt(prompt("Price DA"));
if(isNaN(price)) return;
let cat = prompt("Category (Drink/Food)");
let stock = parseInt(prompt("Initial stock"));
if(isNaN(stock)) stock = 0;

PRODUCTS.push({name,price,cat,stock,code:""});
save(); render();
}

/* ================== PRODUCT MENU ================== */
let scanTarget = null;

function productMenu(i){
let c = prompt(
"1 = Modify\n"+
"2 = Add / Remove stock\n"+
"3 = Scan barcode\n"+
"4 = Delete"
);

if(c==="1"){
let n=prompt("Name",PRODUCTS[i].name);
let p=parseInt(prompt("Price",PRODUCTS[i].price));
let cat=prompt("Category",PRODUCTS[i].cat);
if(n)PRODUCTS[i].name=n;
if(!isNaN(p))PRODUCTS[i].price=p;
if(cat)PRODUCTS[i].cat=cat;
}

if(c==="2"){
let q=parseInt(prompt("Stock change (+ or -):"));
if(!isNaN(q)){
PRODUCTS[i].stock+=q;
if(PRODUCTS[i].stock<0) PRODUCTS[i].stock=0;
}
}

if(c==="3"){
scanTarget = i;
startScanAssign();
return;
}

if(c==="4"){
if(confirm("Delete product?")) PRODUCTS.splice(i,1);
}

save(); render();
}

/* ================== SCAN TO ASSIGN BARCODE ================== */
function startScanAssign(){
scanner.classList.remove("hidden");
const qr=new Html5Qrcode("scanner");
qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
qr.stop(); scanner.classList.add("hidden");
if(scanTarget!==null){
PRODUCTS[scanTarget].code = code;
scanTarget = null;
save(); render();
}
});
}

/* ================== CART ================== */
function addToCart(i){
let p=PRODUCTS[i];
if(p.stock<=0) return alert("Out of stock");
p.stock--;
cart.push({index:i,...p});
save(); render(); renderCart();
}

function renderCart(){
cartItems.innerHTML="";
let t=0;
cart.forEach((p,i)=>{
t+=p.price;
cartItems.innerHTML+=`${p.name} - ${p.price} DA <span onclick="removeItem(${i})">‚úñ</span><br>`;
});
total.innerText=t;
}

function removeItem(i){
PRODUCTS[cart[i].index].stock++;
cart.splice(i,1);
save(); render(); renderCart();
}

function clearCart(){
cart.forEach(i=>PRODUCTS[i.index].stock++);
cart=[]; save(); render(); renderCart();
}

function checkout(){
cart=[]; save(); renderCart();
}

/* ================== SCAN TO SELL ================== */
const beep = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=");
function startScanSell(){
scanner.classList.remove("hidden");
const qr=new Html5Qrcode("scanner");
qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
let matches = PRODUCTS.filter(p=>p.code===code);
if(matches.length===0) return alert("Product not found");
if(matches.length>1) return alert("Barcode conflict");

let index = PRODUCTS.findIndex(p=>p.code===code);
addToCart(index);
beep.play();
});
}
</script>

</body>
</html>
