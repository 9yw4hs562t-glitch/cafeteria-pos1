<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CAFE LEGENDAIRE</title>
<meta name="theme-color" content="#3a2a1d">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
/* ===== BACKGROUND ===== */
body{
  margin:0;
  font-family:Arial;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  background:url("IMG_0069.jpeg") center/cover no-repeat;
  filter:blur(6px) brightness(0.9);
  z-index:-2;
}

/* ===== UI ===== */
header{
  background:rgba(34,34,34,0.9);
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  letter-spacing:1px;
}

.container{padding:10px}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  margin-top:10px
}

.product,.panel,.cart{
  background:rgba(255,255,255,0.92);
  backdrop-filter:blur(2px);
  padding:10px;
  border-radius:8px;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
  margin-top:12px;
}

.product{position:relative}

.menu{
  position:absolute;
  top:5px;
  right:8px;
  font-size:18px;
  cursor:pointer;
}

.small{font-size:12px;color:#444}

button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border:none;
  border-radius:6px;
  font-size:15px;
  color:#fff;
  box-shadow:0 3px 6px rgba(0,0,0,.25);
}

.green{background:#28a745}
.red{background:#dc3545}
.blue{background:#007bff}
.gray{background:#6c757d}

.filter{
  display:flex;
  gap:6px;
  margin-top:8px
}
.filter button{flex:1}

.hidden{display:none}
#scanner{width:100%;margin-top:10px}
</style>
</head>

<body>

<header>‚òï CAFE LEGENDAIRE</header>

<div class="container">

<!-- SESSION -->
<div class="panel">
<select id="worker">
<option>Ismat</option>
<option>Ahmed</option>
<option>Admin 3</option>
<option>Admin 4</option>
<option>Admin 5</option>
<option>Admin 6</option>
<option>Admin 7</option>
</select>

<select id="shift"></select>
<button class="gray" onclick="endShift()">‚è± End Shift</button>
</div>

<!-- PRODUCTS -->
<h3>Products</h3>

<div class="filter">
<button class="gray" onclick="filterCat('all')">All</button>
<button class="blue" onclick="filterCat('Drink')">Drinks</button>
<button class="green" onclick="filterCat('Food')">Food</button>
</div>

<button class="blue" onclick="addProduct()">‚ûï Add Product</button>
<button class="gray" onclick="toggleScanSell()">üì∑ Scan (Sell)</button>

<div id="scanner" class="hidden"></div>
<div class="products" id="products"></div>

<!-- CART -->
<div class="cart">
<h3>Current Order</h3>
<div id="cartItems"></div>
<b>Total: <span id="total">0</span> DA</b>
<button class="green" onclick="checkout()">‚úî Validate Order</button>
<button class="red" onclick="clearCart()">‚úñ Clear</button>
</div>

<!-- ADMIN -->
<div class="panel">
<input type="password" id="pin" placeholder="Admin PIN">
<button class="gray" onclick="openAdmin()">üîê Admin</button>

<div id="admin" class="hidden">
<h4>üìä Accounting</h4>
<button class="blue" onclick="report('shift')">Shift</button>
<button class="blue" onclick="report('day')">Day</button>
<button class="blue" onclick="report('week')">Week</button>
<button class="blue" onclick="report('month')">Month</button>

<button class="blue" onclick="exportExcel()">üì• Export Excel</button>
<div id="reports"></div>
</div>
</div>

</div>

<script>
/* ===== DATA ===== */
const ADMIN_PIN="5554";
let PRODUCTS=JSON.parse(localStorage.getItem("products"))||[];
let SALES=JSON.parse(localStorage.getItem("sales"))||[];
let cart=[],filter="all";
let SHIFT=localStorage.getItem("shift")||"Morning";

shift.innerHTML=`<option>${SHIFT}</option>`;

/* ===== SAVE ===== */
function save(){
localStorage.setItem("products",JSON.stringify(PRODUCTS));
localStorage.setItem("sales",JSON.stringify(SALES));
localStorage.setItem("shift",SHIFT);
}

/* ===== SHIFT ===== */
function endShift(){
SHIFT=SHIFT==="Morning"?"Evening":"Morning";
shift.innerHTML=`<option>${SHIFT}</option>`;
save();alert("Shift changed to "+SHIFT);
}

/* ===== PRODUCTS ===== */
function render(){
products.innerHTML="";
PRODUCTS.forEach((p,i)=>{
if(filter!=="all" && p.cat!==filter)return;
let d=document.createElement("div");
d.className="product";
d.innerHTML=`
<div class="menu" onclick="productMenu(${i})">‚ãÆ</div>
<b>${p.name}</b><br>
<span class="small">${p.price} DA ‚Äì ${p.cat}</span><br>
<span class="small">Stock: ${p.stock}</span>`;
d.onclick=()=>addToCart(i);
products.appendChild(d);
});
}
render();

function filterCat(c){filter=c;render();}

function addProduct(){
let name=prompt("Product name");
if(!name)return;
let price=parseInt(prompt("Price DA"));
if(isNaN(price))return;
let cat=prompt("Category (Drink/Food)");
let stock=parseInt(prompt("Initial stock"))||0;
PRODUCTS.push({name,price,cat,stock,code:""});
save();render();
}

/* ===== PRODUCT MENU ===== */
let scanAssignIndex=null;

function productMenu(i){
let c=prompt("1 Modify\n2 Stock +/-\n3 Scan barcode\n4 Delete");
if(c==="1"){
let n=prompt("Name",PRODUCTS[i].name);
let p=parseInt(prompt("Price",PRODUCTS[i].price));
if(n)PRODUCTS[i].name=n;
if(!isNaN(p))PRODUCTS[i].price=p;
}
if(c==="2"){
let q=parseInt(prompt("Stock change + / -"));
if(!isNaN(q)){
PRODUCTS[i].stock+=q;
if(PRODUCTS[i].stock<0)PRODUCTS[i].stock=0;
}
}
if(c==="3"){
scanAssignIndex=i;
toggleScanAssign();return;
}
if(c==="4"){
if(confirm("Delete product?"))PRODUCTS.splice(i,1);
}
save();render();
}

/* ===== CART ===== */
function addToCart(i){
if(PRODUCTS[i].stock<=0)return alert("Out of stock");
PRODUCTS[i].stock--;
cart.push({index:i,...PRODUCTS[i]});
save();render();renderCart();
}

function renderCart(){
cartItems.innerHTML="";
let t=0;
cart.forEach((p,i)=>{
t+=p.price;
cartItems.innerHTML+=`${p.name} - ${p.price} DA <span onclick="removeItem(${i})">‚úñ</span><br>`;
});
total.innerText=t;
}

function removeItem(i){
PRODUCTS[cart[i].index].stock++;
cart.splice(i,1);
save();render();renderCart();
}

function clearCart(){
cart.forEach(i=>PRODUCTS[i.index].stock++);
cart=[];save();render();renderCart();
}

function checkout(){
if(!cart.length)return;
SALES.push({
date:new Date().toLocaleDateString(),
time:new Date().toLocaleTimeString(),
shift:SHIFT,
admin:worker.value,
total:cart.reduce((a,b)=>a+b.price,0
