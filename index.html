<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cafeteria POS</title>
<meta name="theme-color" content="#222">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#222;color:#fff;padding:12px;text-align:center;font-size:18px}
.container{padding:10px}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
.product{background:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);position:relative}
.menu{position:absolute;top:5px;right:5px;font-size:18px;cursor:pointer}
.small{font-size:12px;color:#555}
.cart,.panel{background:#fff;margin-top:15px;padding:10px;border-radius:8px}
button{width:100%;padding:10px;margin-top:6px;border:none;border-radius:6px;font-size:15px;color:#fff}
.green{background:#28a745}
.red{background:#dc3545}
.blue{background:#007bff}
.gray{background:#6c757d}
.filter{display:flex;gap:6px;margin-top:8px}
.filter button{flex:1}
.hidden{display:none}
#scanner{width:100%;margin-top:10px}
</style>
</head>
<body>

<header>üìä Cafeteria POS</header>

<div class="container">

<div class="panel">
<select id="worker">
<option>Admin 1</option><option>Admin 2</option><option>Admin 3</option>
<option>Admin 4</option><option>Admin 5</option><option>Admin 6</option><option>Admin 7</option>
</select>
<select id="shift"></select>
<button class="gray" onclick="endShift()">‚è± End Shift</button>
</div>

<h3>Products</h3>
<div class="filter">
<button class="gray" onclick="filterCat('all')">All</button>
<button class="blue" onclick="filterCat('Drink')">Drinks</button>
<button class="green" onclick="filterCat('Food')">Food</button>
</div>

<button class="blue" onclick="addProduct()">‚ûï Add Product</button>
<button class="gray" onclick="startFastScan()">üì∑ Scan Product</button>

<div id="scanner" class="hidden"></div>
<div class="products" id="products"></div>

<div class="cart">
<h3>Current Order</h3>
<div id="cartItems"></div>
<b>Total: <span id="total">0</span> DA</b>
<button class="green" onclick="checkout()">‚úî Validate Order</button>
<button class="red" onclick="clearCart()">‚úñ Clear</button>
</div>

</div>

<script>
let PRODUCTS = JSON.parse(localStorage.getItem("products")) || [];
let cart = [];
let filter = "all";
let SHIFT = localStorage.getItem("shift") || "Morning";
shift.innerHTML = `<option>${SHIFT}</option>`;

function save(){
localStorage.setItem("products",JSON.stringify(PRODUCTS));
localStorage.setItem("shift",SHIFT);
}

function endShift(){
SHIFT = SHIFT==="Morning" ? "Evening" : "Morning";
shift.innerHTML=`<option>${SHIFT}</option>`;
save(); alert("Shift changed");
}

/* üîä Beep sound */
const beep = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=");

function render(){
products.innerHTML="";
PRODUCTS.forEach((p,i)=>{
if(filter!=="all" && p.cat!==filter) return;
let d=document.createElement("div");
d.className="product";
d.innerHTML=`<b>${p.name}</b><br>${p.price} DA<br>Stock: ${p.stock}`;
d.onclick=()=>addToCart(i);
products.appendChild(d);
});
}
render();

function addToCart(i){
let p=PRODUCTS[i];
if(p.stock<=0) return alert("Out of stock");
p.stock--;
cart.push({index:i,...p});
beep.play();
save(); render(); renderCart();
}

function renderCart(){
cartItems.innerHTML="";
let t=0;
cart.forEach((p,i)=>{
t+=p.price;
cartItems.innerHTML+=`${p.name} - ${p.price} DA <span onclick="removeItem(${i})">‚úñ</span><br>`;
});
total.innerText=t;
}

function removeItem(i){
PRODUCTS[cart[i].index].stock++;
cart.splice(i,1);
save(); render(); renderCart();
}

function clearCart(){
cart.forEach(i=>PRODUCTS[i.index].stock++);
cart=[]; save(); render(); renderCart();
}

function checkout(){
cart=[]; save(); renderCart();
}

/* üì∑ FAST SCAN MODE */
let scanner;
function startFastScan(){
scanner=document.getElementById("scanner");
scanner.classList.remove("hidden");

const qr=new Html5Qrcode("scanner");
qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
let matches = PRODUCTS.filter(p=>p.code===code);

if(matches.length===0){
alert("Product not found"); return;
}
if(matches.length>1){
alert("Barcode conflict!"); return;
}

let index = PRODUCTS.findIndex(p=>p.code===code);
addToCart(index);
});
}
</script>

</body>
</html>
