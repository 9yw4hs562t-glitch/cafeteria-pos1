<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cafeteria POS</title>
<meta name="theme-color" content="#222">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#222;color:#fff;padding:12px;text-align:center;font-size:18px}
.container{padding:10px}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
.product{background:#fff;padding:10px;border-radius:8px;
box-shadow:0 2px 5px rgba(0,0,0,.1);position:relative}
.menu{position:absolute;top:5px;right:5px;font-size:18px;cursor:pointer}
.small{font-size:12px;color:#555}
.cart,.panel{background:#fff;margin-top:15px;padding:10px;border-radius:8px}
button{width:100%;padding:10px;margin-top:6px;border:none;border-radius:6px;font-size:15px;color:#fff}
.green{background:#28a745}
.red{background:#dc3545}
.blue{background:#007bff}
.gray{background:#6c757d}
.filter{display:flex;gap:6px;margin-top:8px}
.filter button{flex:1}
.hidden{display:none}
#scanner{width:100%;margin-top:10px}
</style>
</head>
<body>

<header>üìä Cafeteria POS</header>

<div class="container">

<div class="panel">
<select id="worker">
<option>Admin 1</option><option>Admin 2</option><option>Admin 3</option>
<option>Admin 4</option><option>Admin 5</option><option>Admin 6</option><option>Admin 7</option>
</select>
<select id="shift"></select>
<button class="gray" onclick="endShift()">‚è± End Shift</button>
</div>

<h3>Products</h3>
<div class="filter">
<button class="gray" onclick="filterCat('all')">All</button>
<button class="blue" onclick="filterCat('Drink')">Drinks</button>
<button class="green" onclick="filterCat('Food')">Food</button>
</div>

<button class="blue" onclick="startAddProduct()">‚ûï Add Product</button>

<div id="scanner" class="hidden"></div>
<div class="products" id="products"></div>

<div class="cart">
<h3>Current Order</h3>
<div id="cartItems"></div>
<b>Total: <span id="total">0</span> DA</b>
<button class="green" onclick="checkout()">‚úî Validate Order</button>
<button class="red" onclick="clearCart()">‚úñ Clear</button>
</div>

<div class="panel">
<input type="password" id="pin" placeholder="Admin PIN">
<button class="gray" onclick="openAdmin()">üîê Admin</button>

<div id="admin" class="hidden">
<h4>üí∞ Cash</h4>
<input type="number" placeholder="Opening cash" onchange="setOpening(this.value)">
<button class="blue" onclick="cashIn()">Cash In</button>
<button class="red" onclick="cashOut()">Cash Out</button>
<div id="cashInfo"></div>

<h4>üìä Reports</h4>
<button class="blue" onclick="exportExcel()">üì• Export Excel</button>
<div id="reports"></div>
</div>
</div>

</div>

<script>
const ADMIN_PIN="1234";
let cart=[],filter="all";
let SHIFT = localStorage.getItem("shift") || "Morning";

let PRODUCTS=JSON.parse(localStorage.getItem("products"))||[];
let SALES=JSON.parse(localStorage.getItem("sales"))||[];
let CASH=JSON.parse(localStorage.getItem("cash"))||{opening:0,in:0,out:0};

shift.innerHTML=`<option>${SHIFT}</option>`;

function save(){
localStorage.setItem("products",JSON.stringify(PRODUCTS));
localStorage.setItem("sales",JSON.stringify(SALES));
localStorage.setItem("cash",JSON.stringify(CASH));
localStorage.setItem("shift",SHIFT);
}

function endShift(){
SHIFT = SHIFT==="Morning" ? "Evening" : "Morning";
shift.innerHTML=`<option>${SHIFT}</option>`;
save();
alert("Shift changed to "+SHIFT);
}

function render(){
products.innerHTML="";
PRODUCTS.forEach((p,i)=>{
if(filter!=="all" && p.cat!==filter)return;
let d=document.createElement("div");
d.className="product";
d.innerHTML=`
<div class="menu" onclick="productMenu(${i})">‚ãÆ</div>
<b>${p.name}</b><br>
<span class="small">${p.price} DA ‚Äì ${p.cat}</span><br>
<span class="small">Stock: ${p.stock}</span>`;
d.onclick=()=>{
if(p.stock<=0)return alert("Out of stock");
p.stock--;
cart.push({...p,time:new Date().toLocaleTimeString()});
save();render();renderCart();
};
products.appendChild(d);
});
}
render();

function productMenu(i){
let c=prompt("1 = Modify\n2 = Delete");
if(c==="1"){
let n=prompt("Name",PRODUCTS[i].name);
let p=parseInt(prompt("Price",PRODUCTS[i].price));
let s=parseInt(prompt("Stock",PRODUCTS[i].stock));
PRODUCTS[i].name=n;PRODUCTS[i].price=p;PRODUCTS[i].stock=s;
}
if(c==="2" && confirm("Delete product?"))PRODUCTS.splice(i,1);
save();render();
}

function filterCat(c){filter=c;render();}

function startAddProduct(){
scanner.classList.remove("hidden");
const qr=new Html5Qrcode("scanner");
qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
qr.stop();scanner.classList.add("hidden");
let name=prompt("Product name");
let price=parseInt(prompt("Price DA"));
let cat=prompt("Category (Drink/Food)");
let stock=parseInt(prompt("Initial stock"));
PRODUCTS.push({name,price,cat,stock,code});
save();render();
});
}

function renderCart(){
cartItems.innerHTML=""; let t=0;
cart.forEach((p,i)=>{
t+=p.price;
cartItems.innerHTML+=`${p.name} (${p.time}) - ${p.price} DA <span onclick="cart.splice(${i},1);renderCart()">‚úñ</span><br>`;
});
total.innerText=t;
}

function clearCart(){cart=[];renderCart();}

function checkout(){
if(!cart.length)return;
SALES.push({
date:new Date().toLocaleDateString(),
time:new Date().toLocaleTimeString(),
shift:SHIFT,
admin:worker.value,
items:cart,
total:cart.reduce((a,b)=>a+b.price,0)
});
save();clearCart();
}

function openAdmin(){
if(pin.value!==ADMIN_PIN)return alert("Wrong PIN");
admin.classList.toggle("hidden");
renderCash();
}

function setOpening(v){CASH.opening=parseInt(v)||0;save();renderCash();}
function cashIn(){let v=parseInt(prompt("Cash in"));if(!isNaN(v)){CASH.in+=v;save();renderCash();}}
function cashOut(){let v=parseInt(prompt("Cash out"));if(!isNaN(v)){CASH.out+=v;save();renderCash();}}

function renderCash(){
let salesTotal=SALES.reduce((a,b)=>a+b.total,0);
let expected=CASH.opening+salesTotal+CASH.in-CASH.out;
cashInfo.innerHTML=`Opening: ${CASH.opening} DA<br>In: ${CASH.in} DA<br>Out: ${CASH.out} DA<br>Expected: ${expected} DA`;
}

function exportExcel(){
let csv="Date,Time,Shift,Admin,Product,Category,Price\n";
SALES.forEach(s=>{
s.items.forEach(i=>{
csv+=`${s.date},${s.time},${s.shift},${s.admin},${i.name},${i.cat},${i.price}\n`;
});
});
csv+="\nCASH\nOpening,"+CASH.opening+"\nIn,"+CASH.in+"\nOut,"+CASH.out;
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
a.download="cafeteria_pos_all_data.csv";
a.click();
}
</script>

</body>
</html>
